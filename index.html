<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Workout Tracker</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#000000">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#007AFF">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Workout Tracker">
    
    <!-- iOS Specific Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Workout Tracker">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">
    
    <!-- iOS App Icon Links -->
    <link rel="apple-touch-icon" href="icons/icon-180.svg">
    <link rel="apple-touch-icon" sizes="57x57" href="icons/icon-57.svg">
    <link rel="apple-touch-icon" sizes="60x60" href="icons/icon-60.svg">
    <link rel="apple-touch-icon" sizes="72x72" href="icons/icon-72.svg">
    <link rel="apple-touch-icon" sizes="76x76" href="icons/icon-76.svg">
    <link rel="apple-touch-icon" sizes="114x114" href="icons/icon-114.svg">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/icon-120.svg">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144.svg">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.svg">
    
    <!-- iOS Splash Screens -->
    <link rel="apple-touch-startup-image" href="splash/splash-2048x2732.svg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2732x2048.svg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-1668x2388.svg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2388x1668.svg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-1536x2048.svg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2048x1536.svg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-1668x2224.svg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2224x1668.svg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-1620x2160.svg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2160x1620.svg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-1290x2796.svg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2796x1290.svg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-1179x2556.svg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2556x1179.svg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-1284x2778.svg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2778x1284.svg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-1170x2532.svg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2532x1170.svg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-1125x2436.svg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2436x1125.svg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-1242x2688.svg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2688x1242.svg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-828x1792.svg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-1792x828.svg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-1242x2208.svg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-2208x1242.svg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-750x1334.svg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-1334x750.svg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="splash/splash-640x1136.svg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="splash/splash-1136x640.svg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    
    <!-- Standard PWA Links -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="icons/icon-32.svg">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="icons/icon-16.svg">
    <link rel="icon" type="image/svg+xml" sizes="192x192" href="icons/icon-192.svg">
    <link rel="icon" type="image/svg+xml" sizes="512x512" href="icons/icon-512.svg">
    <link rel="shortcut icon" href="favicon.svg">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileColor" content="#007AFF">
    <meta name="msapplication-TileImage" content="icons/icon-144.svg">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- Additional iOS Meta Tags -->
    <meta name="apple-itunes-app" content="app-id=myAppStoreID, app-argument=myScheme://path/to/content">
    <meta name="apple-mobile-web-app-orientations" content="portrait">
    <meta name="apple-touch-icon-precomposed" href="icons/icon-180.svg">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/ios-theme.css">
    <link rel="stylesheet" href="css/user-profile.css">
</head>
<body>
    <div class="app-container">
        <!-- App Header -->
        <header class="app-header">
            <h1>Workout Tracker</h1>
            <button class="header-menu-btn" aria-label="Menu">
                <span class="hamburger"></span>
            </button>
        </header>

        <!-- Bottom Tab Navigation -->
        <nav class="tab-bar ios-tab-bar">
            <button class="tab-button ios-tab-item active" data-tab="exercises">
                <span class="tab-icon">üèãÔ∏è</span>
                <span class="tab-label">Exercises</span>
            </button>
            <button class="tab-button ios-tab-item" data-tab="workouts">
                <span class="tab-icon">üí™</span>
                <span class="tab-label">Workouts</span>
            </button>
            <button class="tab-button ios-tab-item" data-tab="plans">
                <span class="tab-icon">üìã</span>
                <span class="tab-label">Plans</span>
            </button>
            <button class="tab-button ios-tab-item" data-tab="profile">
                <span class="tab-icon">üìä</span>
                <span class="tab-label">Progress</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Exercises Tab -->
            <div class="tab-content active" id="exercises-tab">
                <div class="search-container">
                    <input type="search" class="search-input ios-input" placeholder="Search exercises..." id="exercise-search">
                </div>
                
                <div class="exercise-categories">
                    <div class="category-filter ios-segment-control">
                        <button class="filter-btn ios-segment-item active" data-category="all">All</button>
                        <button class="filter-btn ios-segment-item" data-category="chest">Chest</button>
                        <button class="filter-btn ios-segment-item" data-category="back">Back</button>
                        <button class="filter-btn ios-segment-item" data-category="legs">Legs</button>
                        <button class="filter-btn ios-segment-item" data-category="shoulders">Shoulders</button>
                        <button class="filter-btn ios-segment-item" data-category="arms">Arms</button>
                    </div>
                </div>
                
                <div class="exercise-list" id="exercise-list">
                    <!-- Exercise items will be inserted here -->
                </div>
            </div>

            <!-- Workouts Tab -->
            <div class="tab-content" id="workouts-tab">
                <div class="quick-start-card ios-card">
                    <h2>Quick Start</h2>
                    <button class="btn ios-button" id="start-workout-btn">Start Workout</button>
                </div>
                
                <div class="recent-workouts">
                    <h3>Recent Workouts</h3>
                    <div class="workout-list" id="recent-workouts-list">
                        <!-- Workout items will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Plans Tab -->
            <div class="tab-content" id="plans-tab">
                <div class="plans-header">
                    <h2>Workout Plans</h2>
                    <button class="btn ios-button-secondary" id="create-plan-btn">Create Plan</button>
                </div>
                
                <div class="plans-list" id="plans-list">
                    <!-- Plan items will be inserted here -->
                </div>
            </div>

            <!-- Profile Tab -->
            <div class="tab-content" id="profile-tab">
                <div class="profile-header">
                    <div class="profile-avatar-section">
                        <div class="avatar-placeholder avatar avatar-large">üë§</div>
                    </div>
                    <div class="profile-name">Set Your Name</div>
                    <div class="profile-subtitle">Customize your profile</div>
                    <div class="profile-bio" style="display: none;"></div>
                </div>
                
                <div class="stats-section">
                    <h3>Your Stats</h3>
                    <div class="stats-grid">
                        <div class="stat-card ios-card">
                            <div class="stat-number" id="total-workouts">0</div>
                            <div class="stat-label">Total Workouts</div>
                        </div>
                        <div class="stat-card ios-card">
                            <div class="stat-number" id="total-exercises">0</div>
                            <div class="stat-label">Exercises Done</div>
                        </div>
                        <div class="stat-card ios-card">
                            <div class="stat-number" id="current-streak">0</div>
                            <div class="stat-label">Day Streak</div>
                        </div>
                        <div class="stat-card ios-card">
                            <div class="stat-number" id="total-volume">0</div>
                            <div class="stat-label">Total Volume (lbs)</div>
                        </div>
                    </div>
                </div>

                <div class="profile-menu ios-list">
                    <div class="ios-list-item" id="theme-selector">
                        <div class="ios-list-icon">üé®</div>
                        <div class="ios-list-content">
                            <div class="ios-list-title">Theme</div>
                            <div class="theme-buttons">
                                <button class="theme-btn" data-theme="light">‚òÄÔ∏è Light</button>
                                <button class="theme-btn active" data-theme="dark">üåô Dark</button>
                                <button class="theme-btn" data-theme="auto">üîÑ Auto</button>
                            </div>
                        </div>
                    </div>
                    <div class="ios-list-item" id="data-management-btn">
                        <div class="ios-list-icon">üíæ</div>
                        <div class="ios-list-content">
                            <div class="ios-list-title">Data Management</div>
                        </div>
                        <div class="ios-list-chevron">‚Ä∫</div>
                    </div>
                    <div class="ios-list-item" id="settings-btn">
                        <div class="ios-list-icon">‚öôÔ∏è</div>
                        <div class="ios-list-content">
                            <div class="ios-list-title">Settings</div>
                        </div>
                        <div class="ios-list-chevron">‚Ä∫</div>
                    </div>
                    <div class="ios-list-item" id="export-data-btn">
                        <div class="ios-list-icon">üì§</div>
                        <div class="ios-list-content">
                            <div class="ios-list-title">Export Data</div>
                        </div>
                        <div class="ios-list-chevron">‚Ä∫</div>
                    </div>
                    <div class="ios-list-item" id="about-btn">
                        <div class="ios-list-icon">‚ÑπÔ∏è</div>
                        <div class="ios-list-content">
                            <div class="ios-list-title">About</div>
                        </div>
                        <div class="ios-list-chevron">‚Ä∫</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Workout Modal -->
    <div class="modal" id="workout-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Active Workout</h2>
                <button class="modal-close" id="close-workout-modal">&times;</button>
            </div>
            <div class="modal-body" id="workout-modal-body">
                <!-- Workout content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Data Management Modal -->
    <div class="modal" id="data-management-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Data Management</h2>
                <button class="modal-close" id="close-data-management-modal">&times;</button>
            </div>
            <div class="modal-body" id="data-management-modal-body">
                <!-- Storage Usage Section -->
                <div class="data-section">
                    <h3>Storage Usage</h3>
                    <div class="storage-stats" id="storage-stats">
                        <div class="storage-meter">
                            <div class="storage-used" id="storage-used-bar"></div>
                        </div>
                        <div class="storage-details" id="storage-details">
                            <div class="storage-text">Calculating...</div>
                        </div>
                    </div>
                </div>

                <!-- Export Data Section -->
                <div class="data-section">
                    <h3>Export Data</h3>
                    <div class="export-options">
                        <div class="export-format-selector">
                            <label>Export Format:</label>
                            <select id="export-format-select" class="ios-select">
                                <option value="json">JSON (Complete Backup)</option>
                                <option value="csv">CSV (Spreadsheet)</option>
                                <option value="txt">Text (Summary)</option>
                            </select>
                        </div>
                        <div class="export-options-group">
                            <label>
                                <input type="checkbox" id="include-personal-data" checked>
                                Include personal data (measurements, goals)
                            </label>
                            <label>
                                <input type="checkbox" id="include-statistics" checked>
                                Include statistics
                            </label>
                            <label>
                                <input type="checkbox" id="compact-export">
                                Compact format (smaller file size)
                            </label>
                        </div>
                        <button class="btn ios-button" id="export-data-btn-modal">Export Data</button>
                    </div>
                </div>

                <!-- Import Data Section -->
                <div class="data-section">
                    <h3>Import Data</h3>
                    <div class="import-options">
                        <div class="file-input-wrapper">
                            <input type="file" id="import-file-input" accept=".json,.csv" style="display: none;">
                            <button class="btn ios-button-secondary" id="select-import-file">Select File</button>
                            <div class="file-info" id="import-file-info"></div>
                        </div>
                        <div class="import-options-group">
                            <label>
                                <input type="checkbox" id="skip-duplicates" checked>
                                Skip duplicate workouts
                            </label>
                            <label>
                                <input type="checkbox" id="validate-import" checked>
                                Validate data before import
                            </label>
                        </div>
                        <button class="btn ios-button" id="import-data-btn" disabled>Import Data</button>
                    </div>
                </div>

                <!-- Share Plans Section -->
                <div class="data-section">
                    <h3>Share Workout Plans</h3>
                    <div class="share-options">
                        <div class="plan-selector">
                            <label>Select Plan:</label>
                            <select id="share-plan-select" class="ios-select">
                                <option value="">Choose a plan to share...</option>
                            </select>
                        </div>
                        <div class="share-format-selector">
                            <label>Share Format:</label>
                            <select id="share-format-select" class="ios-select">
                                <option value="text">Text (Easy to share)</option>
                                <option value="json">JSON (Complete data)</option>
                            </select>
                        </div>
                        <button class="btn ios-button" id="share-plan-btn" disabled>Share Plan</button>
                    </div>
                </div>

                <!-- Data Cleanup Section -->
                <div class="data-section">
                    <h3>Data Cleanup</h3>
                    <div class="cleanup-options">
                        <div class="cleanup-option">
                            <label>Clean old data (older than):</label>
                            <select id="cleanup-age-select" class="ios-select">
                                <option value="30">30 days</option>
                                <option value="60">60 days</option>
                                <option value="90">90 days</option>
                                <option value="180">6 months</option>
                                <option value="365">1 year</option>
                            </select>
                            <button class="btn ios-button-secondary" id="cleanup-old-data-btn">Clean Old Data</button>
                        </div>
                        <div class="cleanup-warning">
                            <p><strong>‚ö†Ô∏è Reset All Data</strong></p>
                            <p>This will permanently delete all your workout data. This action cannot be undone.</p>
                            <button class="btn ios-button-destructive" id="reset-all-data-btn">Reset All Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loading-spinner">
        <div class="spinner"></div>
    </div>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Show update notification
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
            
            // Listen for service worker messages
            navigator.serviceWorker.addEventListener('message', function(event) {
                if (event.data && event.data.type === 'update-available') {
                    showUpdateNotification();
                }
                
                if (event.data && event.data.type === 'sync-success') {
                    showSyncSuccessNotification(event.data.data);
                }
            });
        }
        
        // Show update notification
        function showUpdateNotification() {
            // Create update notification banner
            const banner = document.createElement('div');
            banner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: #007AFF;
                color: white;
                padding: 10px 20px;
                text-align: center;
                z-index: 10000;
                font-size: 14px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            `;
            banner.innerHTML = `
                <span>New version available! </span>
                <button onclick="updateApp()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; margin-left: 10px; cursor: pointer;">
                    Update Now
                </button>
                <button onclick="dismissUpdate()" style="background: none; border: none; color: white; padding: 5px 10px; margin-left: 10px; cursor: pointer;">
                    √ó
                </button>
            `;
            document.body.appendChild(banner);
        }
        
        // Update app
        function updateApp() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistration().then(function(registration) {
                    if (registration && registration.waiting) {
                        registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                        window.location.reload();
                    }
                });
            }
        }
        
        // Dismiss update notification
        function dismissUpdate() {
            const banner = document.querySelector('div[style*="position: fixed"][style*="top: 0"]');
            if (banner) {
                banner.remove();
            }
        }
        
        // Show sync success notification
        function showSyncSuccessNotification(data) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                font-size: 14px;
                max-width: 300px;
            `;
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">‚úì Data Synced</div>
                <div style="font-size: 12px; opacity: 0.9;">Your workout data has been synchronized</div>
            `;
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Check for updates periodically
        setInterval(function() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistration().then(function(registration) {
                    if (registration) {
                        registration.update();
                    }
                });
            }
        }, 60000); // Check every minute
    </script>
    
    <!-- Scripts -->
    <script src="js/database.js"></script>
    <script src="js/exercises.js"></script>
    <script src="js/workouts.js"></script>
    <script src="js/plans.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/progress.js"></script>
    <script src="js/timers.js"></script>
    <script src="js/timer-ui.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/user-profile.js"></script>
    <script src="js/profile-ui.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Fallback button functionality -->
    <script>
        // Basic fallback functionality if app doesn't initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîß Setting up fallback button functionality...');
            
            // Wait a bit for the main app to load
            setTimeout(function() {
                // Check if main app initialized properly
                if (!window.app || window.app.fallbackMode || !window.app.appState || window.app.appState.isInitialized === false) {
                    console.warn('‚ö†Ô∏è Main app not initialized, setting up fallback handlers');
                    
                    // Enhanced Start Workout button
                    const startWorkoutBtn = document.getElementById('start-workout-btn');
                    if (startWorkoutBtn) {
                        startWorkoutBtn.addEventListener('click', async function() {
                            console.log('‚úÖ Start Workout clicked');
                            
                            // Check if there's already an active workout
                            if (window.currentWorkoutSession && window.currentWorkoutSession.isActive) {
                                // Show existing workout
                                const modal = document.getElementById('workout-modal');
                                if (modal) {
                                    modal.style.display = 'block';
                                    updateWorkoutModal();
                                }
                            } else {
                                // Start new workout
                                try {
                                    await startNewWorkout();
                                    const modal = document.getElementById('workout-modal');
                                    if (modal) {
                                        modal.style.display = 'block';
                                        const body = document.getElementById('workout-modal-body');
                                        body.innerHTML = `
                                            <div class="workout-start-screen">
                                                <h3>üèãÔ∏è New Workout Started!</h3>
                                                <p><strong>Started:</strong> ${new Date().toLocaleTimeString()}</p>
                                                <p>Go to the <strong>Exercises</strong> tab to add exercises to your workout.</p>
                                                <div class="button-group">
                                                    <button class="btn ios-button" onclick="switchToExercisesTab()">Add Exercises</button>
                                                    <button class="btn ios-button-secondary" onclick="document.getElementById('workout-modal').style.display='none'">Close</button>
                                                </div>
                                            </div>
                                        `;
                                    }
                                } catch (error) {
                                    console.error('Error starting workout:', error);
                                    alert('Error starting workout. Please try again.');
                                }
                            }
                        });
                        console.log('‚úÖ Enhanced Start Workout handler added');
                    }
                    
                    // Basic Create Plan button
                    const createPlanBtn = document.getElementById('create-plan-btn');
                    if (createPlanBtn) {
                        createPlanBtn.addEventListener('click', function() {
                            console.log('‚úÖ Create Plan fallback clicked');
                            // Show plan creation interface
                            const modal = document.getElementById('workout-modal');
                            if (modal) {
                                modal.style.display = 'block';
                                const body = document.getElementById('workout-modal-body');
                                body.innerHTML = `
                                    <div class="plan-creation-screen">
                                        <h3>üìã Create Workout Plan</h3>
                                        <div class="form-group">
                                            <label>Plan Name:</label>
                                            <input type="text" class="ios-input" placeholder="Enter plan name" id="plan-name-input">
                                        </div>
                                        <div class="form-group">
                                            <label>Description:</label>
                                            <textarea class="ios-input" placeholder="Plan description" id="plan-description-input"></textarea>
                                        </div>
                                        <div class="button-group">
                                            <button class="btn ios-button" onclick="savePlan()">Save Plan</button>
                                            <button class="btn ios-button-secondary" onclick="document.getElementById('workout-modal').style.display='none'">Cancel</button>
                                        </div>
                                    </div>
                                `;
                            }
                        });
                        console.log('‚úÖ Create Plan fallback handler added');
                    }
                    
                    // Basic tab navigation
                    const tabButtons = document.querySelectorAll('.tab-button');
                    const tabContents = document.querySelectorAll('.tab-content');
                    
                    tabButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            const targetTab = this.dataset.tab;
                            console.log('‚úÖ Tab clicked:', targetTab);
                            
                            // Remove active class from all tabs and contents
                            tabButtons.forEach(btn => btn.classList.remove('active'));
                            tabContents.forEach(content => content.classList.remove('active'));
                            
                            // Add active class to clicked tab and corresponding content
                            this.classList.add('active');
                            const targetContent = document.getElementById(targetTab + '-tab');
                            if (targetContent) {
                                targetContent.classList.add('active');
                            }
                        });
                    });
                    
                    // Load exercises from data file
                    loadExercisesFromFile();
                    
                    // Restore workout session if exists
                    restoreWorkoutSession();
                    
                    // Initialize plans display
                    updatePlansDisplay();
                    
                    console.log('‚úÖ Fallback handlers setup complete');
                } else {
                    console.log('‚úÖ Main app initialized, fallback not needed');
                }
            }, 500);
        });
        
        // Helper functions for fallback functionality
        let exercisesData = [];
        
        async function loadExercisesFromFile() {
            try {
                console.log('üì• Loading exercises from data file...');
                // Try expanded database first, fallback to original
                let response;
                try {
                    response = await fetch('data/exercises-expanded.json');
                    if (!response.ok) throw new Error('Expanded not found');
                } catch {
                    response = await fetch('data/exercises.json');
                }
                
                const exercises = await response.json();
                exercisesData = exercises;
                displayExercises(exercises);
                console.log('‚úÖ Loaded', exercises.length, 'exercises');
            } catch (error) {
                console.error('‚ùå Failed to load exercises:', error);
                // Show comprehensive default exercises if file loading fails
                exercisesData = [
                    {
                        id: 'push-ups',
                        name: 'Push-ups',
                        category: 'chest',
                        equipment: 'bodyweight',
                        difficulty: 'beginner',
                        image: 'https://cdn.muscleandstrength.com/sites/default/files/push-up.jpg',
                        instructions: ['Start in plank position', 'Lower body to ground', 'Push back up']
                    },
                    {
                        id: 'squats',
                        name: 'Squats', 
                        category: 'legs',
                        equipment: 'bodyweight',
                        difficulty: 'beginner',
                        image: 'https://cdn.muscleandstrength.com/sites/default/files/bodyweight-squat.jpg',
                        instructions: ['Stand with feet shoulder-width apart', 'Lower body down', 'Return to standing']
                    },
                    {
                        id: 'planks',
                        name: 'Planks',
                        category: 'core',
                        equipment: 'bodyweight',
                        difficulty: 'beginner',
                        image: 'https://cdn.muscleandstrength.com/sites/default/files/plank.jpg',
                        instructions: ['Hold plank position', 'Keep body straight', 'Engage core']
                    }
                ];
                displayExercises(exercisesData);
            }
        }
        
        function displayExercises(exercises) {
            const container = document.getElementById('exercise-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (exercises.length === 0) {
                container.innerHTML = '<p class="no-data">No exercises found. Try a different search or category.</p>';
                return;
            }
            
            exercises.forEach(exercise => {
                const exerciseElement = createExerciseElement(exercise);
                container.appendChild(exerciseElement);
            });
        }
        
        function createExerciseElement(exercise) {
            const div = document.createElement('div');
            div.className = 'exercise-card ios-card';
            div.setAttribute('data-category', exercise.category);
            
            const imageHtml = exercise.image ? 
                `<div class="exercise-image">
                    <img src="${exercise.image}" alt="${exercise.name}" onerror="this.style.display='none'">
                </div>` : '';
            
            div.innerHTML = `
                ${imageHtml}
                <div class="exercise-content">
                    <div class="exercise-header">
                        <h3 class="exercise-name">${exercise.name}</h3>
                        <span class="exercise-category">${exercise.category}</span>
                    </div>
                    <div class="exercise-details">
                        <span class="exercise-equipment">‚ö° ${exercise.equipment || 'bodyweight'}</span>
                        <span class="exercise-difficulty">üìä ${exercise.difficulty || 'beginner'}</span>
                    </div>
                    <div class="exercise-instructions">
                        <p><strong>Instructions:</strong></p>
                        <ul>
                            ${(exercise.instructions || []).map(instruction => `<li>${instruction}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="exercise-actions">
                        <button class="btn ios-button-secondary" onclick="addToWorkout('${exercise.id}')">‚ûï Add to Workout</button>
                        <button class="btn ios-button-secondary" onclick="showAddToPlanModal('${exercise.id}')">üìã Add to Plan</button>
                    </div>
                </div>
            `;
            return div;
        }
        
        async function addToWorkout(exerciseId) {
            const exercise = exercisesData.find(ex => ex.id === exerciseId);
            if (!exercise) {
                alert('Exercise not found!');
                return;
            }
            
            try {
                // Check if there's an active workout, if not create one
                if (!window.currentWorkoutSession) {
                    await startNewWorkout();
                }
                
                // Add exercise to current workout session
                if (window.currentWorkoutSession) {
                    window.currentWorkoutSession.exercises.push({
                        id: exerciseId,
                        name: exercise.name,
                        category: exercise.category,
                        sets: [],
                        targetSets: 3,
                        targetReps: 10,
                        targetWeight: 0,
                        completedSets: 0,
                        addedAt: new Date()
                    });
                    
                    // Save to localStorage
                    localStorage.setItem('currentWorkout', JSON.stringify(window.currentWorkoutSession));
                    
                    console.log('‚ûï Added exercise to workout:', exercise.name);
                    console.log('Current workout:', window.currentWorkoutSession);
                    
                    alert(`Added "${exercise.name}" to your workout! üèãÔ∏è\n\nExercises in workout: ${window.currentWorkoutSession.exercises.length}`);
                    
                    // Update workout modal if visible
                    updateWorkoutModal();
                } else {
                    alert('Could not add exercise to workout. Please try again.');
                }
            } catch (error) {
                console.error('Error adding exercise to workout:', error);
                alert('Error adding exercise to workout.');
            }
        }
        
        async function startNewWorkout() {
            try {
                window.currentWorkoutSession = {
                    id: Date.now().toString(),
                    name: `Workout ${new Date().toLocaleDateString()}`,
                    startTime: new Date(),
                    exercises: [],
                    duration: 0,
                    totalSets: 0,
                    totalReps: 0,
                    isActive: true
                };
                
                // Save to localStorage
                localStorage.setItem('currentWorkout', JSON.stringify(window.currentWorkoutSession));
                
                console.log('üèãÔ∏è New workout session started:', window.currentWorkoutSession);
                return window.currentWorkoutSession;
            } catch (error) {
                console.error('Error starting new workout:', error);
                throw error;
            }
        }
        
        function updateWorkoutModal() {
            const modal = document.getElementById('workout-modal');
            const body = document.getElementById('workout-modal-body');
            
            if (window.currentWorkoutSession && window.currentWorkoutSession.exercises.length > 0) {
                const exerciseList = window.currentWorkoutSession.exercises.map(ex => 
                    `<div class="workout-exercise">
                        <h4>${ex.name}</h4>
                        <p>Category: ${ex.category}</p>
                        <p>Target: ${ex.targetSets} sets √ó ${ex.targetReps} reps</p>
                        <button class="btn ios-button-secondary" onclick="removeFromWorkout('${ex.id}')">Remove</button>
                    </div>`
                ).join('');
                
                body.innerHTML = `
                    <div class="active-workout">
                        <h3>üèãÔ∏è Active Workout</h3>
                        <p><strong>Started:</strong> ${new Date(window.currentWorkoutSession.startTime).toLocaleTimeString()}</p>
                        <p><strong>Exercises:</strong> ${window.currentWorkoutSession.exercises.length}</p>
                        
                        <div class="workout-exercises">
                            ${exerciseList}
                        </div>
                        
                        <div class="workout-actions">
                            <button class="btn ios-button" onclick="finishWorkout()">Finish Workout</button>
                            <button class="btn ios-button-secondary" onclick="document.getElementById('workout-modal').style.display='none'">Close</button>
                        </div>
                    </div>
                `;
            }
        }
        
        function removeFromWorkout(exerciseId) {
            if (window.currentWorkoutSession) {
                window.currentWorkoutSession.exercises = window.currentWorkoutSession.exercises.filter(ex => ex.id !== exerciseId);
                localStorage.setItem('currentWorkout', JSON.stringify(window.currentWorkoutSession));
                updateWorkoutModal();
                console.log('‚ûñ Removed exercise from workout');
            }
        }
        
        function finishWorkout() {
            if (window.currentWorkoutSession) {
                // Calculate duration
                const endTime = new Date();
                const duration = Math.round((endTime - new Date(window.currentWorkoutSession.startTime)) / 1000 / 60); // minutes
                const exerciseCount = window.currentWorkoutSession.exercises.length;
                
                window.currentWorkoutSession.endTime = endTime;
                window.currentWorkoutSession.duration = duration;
                window.currentWorkoutSession.isActive = false;
                
                // Save completed workout to history
                const workoutHistory = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
                workoutHistory.push(window.currentWorkoutSession);
                localStorage.setItem('workoutHistory', JSON.stringify(workoutHistory));
                
                // Clear current workout
                localStorage.removeItem('currentWorkout');
                
                alert(`Workout completed! üéâ\nDuration: ${duration} minutes\nExercises: ${exerciseCount}`);
                
                // Reset current session after showing alert
                window.currentWorkoutSession = null;
                
                // Update start button text
                const startBtn = document.getElementById('start-workout-btn');
                if (startBtn) {
                    startBtn.textContent = 'Start Workout';
                }
                
                document.getElementById('workout-modal').style.display = 'none';
                console.log('‚úÖ Workout finished and saved to history');
            }
        }
        
        function savePlan() {
            const planName = document.getElementById('plan-name-input')?.value;
            const planDescription = document.getElementById('plan-description-input')?.value;
            
            if (!planName) {
                alert('Please enter a plan name.');
                return;
            }
            
            try {
                // Create plan object
                const plan = {
                    id: Date.now().toString(),
                    name: planName.trim(),
                    description: planDescription?.trim() || '',
                    exercises: [],
                    createdAt: new Date(),
                    isTemplate: true,
                    difficulty: 'beginner',
                    estimatedDuration: 30
                };
                
                // Get existing plans from localStorage
                const existingPlans = JSON.parse(localStorage.getItem('workoutPlans') || '[]');
                
                // Add new plan
                existingPlans.push(plan);
                
                // Save back to localStorage
                localStorage.setItem('workoutPlans', JSON.stringify(existingPlans));
                
                console.log('üíæ Plan saved:', plan);
                alert(`Plan "${planName}" saved successfully! üìã\n\nTotal plans: ${existingPlans.length}`);
                
                // Close modal and refresh plans display
                document.getElementById('workout-modal').style.display = 'none';
                updatePlansDisplay();
                
            } catch (error) {
                console.error('Error saving plan:', error);
                alert('Error saving plan. Please try again.');
            }
        }
        
        function updatePlansDisplay() {
            try {
                const plans = JSON.parse(localStorage.getItem('workoutPlans') || '[]');
                const plansList = document.getElementById('plans-list');
                
                if (plansList && plans.length > 0) {
                    plansList.innerHTML = plans.map(plan => `
                        <div class="plan-card ios-card">
                            <h3>${plan.name}</h3>
                            <p>${plan.description}</p>
                            <div class="plan-meta">
                                <span>üìã ${plan.exercises.length} exercises</span>
                                <span>‚è±Ô∏è ~${plan.estimatedDuration} min</span>
                                <span>üìä ${plan.difficulty}</span>
                            </div>
                            <div class="plan-actions">
                                <button class="btn ios-button-secondary" onclick="startPlanWorkout('${plan.id}')">Start Workout</button>
                                <button class="btn ios-button-secondary" onclick="deletePlan('${plan.id}')">Delete</button>
                            </div>
                        </div>
                    `).join('');
                } else if (plansList) {
                    plansList.innerHTML = '<p class="no-data">No workout plans created yet. Create your first plan!</p>';
                }
            } catch (error) {
                console.error('Error updating plans display:', error);
            }
        }
        
        function startPlanWorkout(planId) {
            try {
                const plans = JSON.parse(localStorage.getItem('workoutPlans') || '[]');
                const plan = plans.find(p => p.id === planId);
                
                if (plan) {
                    // Start a new workout based on this plan
                    startNewWorkout();
                    if (window.currentWorkoutSession) {
                        window.currentWorkoutSession.name = `${plan.name} Workout`;
                        window.currentWorkoutSession.planId = planId;
                        localStorage.setItem('currentWorkout', JSON.stringify(window.currentWorkoutSession));
                    }
                    
                    alert(`Started workout from plan: ${plan.name}! üèãÔ∏è\n\nGo to the Exercises tab to add exercises to your workout.`);
                    
                    // Switch to exercises tab
                    const exercisesTab = document.querySelector('[data-tab="exercises"]');
                    if (exercisesTab) {
                        exercisesTab.click();
                    }
                }
            } catch (error) {
                console.error('Error starting plan workout:', error);
                alert('Error starting workout from plan.');
            }
        }
        
        function deletePlan(planId) {
            if (confirm('Are you sure you want to delete this plan?')) {
                try {
                    const plans = JSON.parse(localStorage.getItem('workoutPlans') || '[]');
                    const updatedPlans = plans.filter(p => p.id !== planId);
                    localStorage.setItem('workoutPlans', JSON.stringify(updatedPlans));
                    updatePlansDisplay();
                    console.log('üóëÔ∏è Plan deleted');
                } catch (error) {
                    console.error('Error deleting plan:', error);
                    alert('Error deleting plan.');
                }
            }
        }
        
        function showAddToPlanModal(exerciseId) {
            const exercise = exercisesData.find(ex => ex.id === exerciseId);
            if (!exercise) return;
            
            const plans = JSON.parse(localStorage.getItem('workoutPlans') || '[]');
            const modal = document.getElementById('workout-modal');
            const body = document.getElementById('workout-modal-body');
            
            if (plans.length === 0) {
                body.innerHTML = `
                    <div class="add-to-plan-screen">
                        <h3>üìã Add "${exercise.name}" to Plan</h3>
                        <p>You don't have any workout plans yet. Create a plan first!</p>
                        <div class="button-group">
                            <button class="btn ios-button" onclick="showCreatePlanForExercise('${exerciseId}')">Create New Plan</button>
                            <button class="btn ios-button-secondary" onclick="document.getElementById('workout-modal').style.display='none'">Cancel</button>
                        </div>
                    </div>
                `;
            } else {
                const planOptions = plans.map(plan => 
                    `<div class="plan-option" onclick="addExerciseToPlan('${exerciseId}', '${plan.id}')">
                        <h4>${plan.name}</h4>
                        <p>${plan.description}</p>
                        <span class="plan-exercise-count">${plan.exercises.length} exercises</span>
                    </div>`
                ).join('');
                
                body.innerHTML = `
                    <div class="add-to-plan-screen">
                        <h3>üìã Add "${exercise.name}" to Plan</h3>
                        <p>Select a plan to add this exercise to:</p>
                        <div class="plan-selection">
                            ${planOptions}
                        </div>
                        <div class="button-group">
                            <button class="btn ios-button-secondary" onclick="showCreatePlanForExercise('${exerciseId}')">Create New Plan</button>
                            <button class="btn ios-button-secondary" onclick="document.getElementById('workout-modal').style.display='none'">Cancel</button>
                        </div>
                    </div>
                `;
            }
            
            modal.style.display = 'block';
        }
        
        function addExerciseToPlan(exerciseId, planId) {
            try {
                const exercise = exercisesData.find(ex => ex.id === exerciseId);
                const plans = JSON.parse(localStorage.getItem('workoutPlans') || '[]');
                const plan = plans.find(p => p.id === planId);
                
                if (!exercise || !plan) {
                    alert('Exercise or plan not found!');
                    return;
                }
                
                // Check if exercise already exists in plan
                if (plan.exercises.some(ex => ex.id === exerciseId)) {
                    alert(`"${exercise.name}" is already in the "${plan.name}" plan!`);
                    return;
                }
                
                // Add exercise to plan
                plan.exercises.push({
                    id: exerciseId,
                    name: exercise.name,
                    category: exercise.category,
                    targetSets: 3,
                    targetReps: 10,
                    targetWeight: 0
                });
                
                // Update estimated duration (rough calculation)
                plan.estimatedDuration = Math.max(30, plan.exercises.length * 5);
                
                // Save updated plans
                localStorage.setItem('workoutPlans', JSON.stringify(plans));
                
                alert(`Added "${exercise.name}" to "${plan.name}" plan! üìã`);
                document.getElementById('workout-modal').style.display = 'none';
                updatePlansDisplay();
                
                console.log('üìã Exercise added to plan:', exercise.name, '‚Üí', plan.name);
            } catch (error) {
                console.error('Error adding exercise to plan:', error);
                alert('Error adding exercise to plan.');
            }
        }
        
        function showCreatePlanForExercise(exerciseId) {
            const exercise = exercisesData.find(ex => ex.id === exerciseId);
            const body = document.getElementById('workout-modal-body');
            
            body.innerHTML = `
                <div class="plan-creation-screen">
                    <h3>üìã Create Plan with "${exercise.name}"</h3>
                    <div class="form-group">
                        <label>Plan Name:</label>
                        <input type="text" class="ios-input" placeholder="Enter plan name" id="plan-name-input">
                    </div>
                    <div class="form-group">
                        <label>Description:</label>
                        <textarea class="ios-input" placeholder="Plan description" id="plan-description-input"></textarea>
                    </div>
                    <div class="button-group">
                        <button class="btn ios-button" onclick="savePlanWithExercise('${exerciseId}')">Create Plan</button>
                        <button class="btn ios-button-secondary" onclick="document.getElementById('workout-modal').style.display='none'">Cancel</button>
                    </div>
                </div>
            `;
        }
        
        function savePlanWithExercise(exerciseId) {
            const planName = document.getElementById('plan-name-input')?.value;
            const planDescription = document.getElementById('plan-description-input')?.value;
            const exercise = exercisesData.find(ex => ex.id === exerciseId);
            
            if (!planName) {
                alert('Please enter a plan name.');
                return;
            }
            
            try {
                const plan = {
                    id: Date.now().toString(),
                    name: planName.trim(),
                    description: planDescription?.trim() || '',
                    exercises: [{
                        id: exerciseId,
                        name: exercise.name,
                        category: exercise.category,
                        targetSets: 3,
                        targetReps: 10,
                        targetWeight: 0
                    }],
                    createdAt: new Date(),
                    isTemplate: true,
                    difficulty: 'beginner',
                    estimatedDuration: 30
                };
                
                const existingPlans = JSON.parse(localStorage.getItem('workoutPlans') || '[]');
                existingPlans.push(plan);
                localStorage.setItem('workoutPlans', JSON.stringify(existingPlans));
                
                alert(`Plan "${planName}" created with "${exercise.name}"! üìã`);
                document.getElementById('workout-modal').style.display = 'none';
                updatePlansDisplay();
                
                console.log('üíæ Plan created with exercise:', plan);
            } catch (error) {
                console.error('Error creating plan with exercise:', error);
                alert('Error creating plan.');
            }
        }
        
        // Add search functionality
        function setupExerciseSearch() {
            const searchInput = document.getElementById('exercise-search');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const filteredExercises = exercisesData.filter(exercise => 
                        exercise.name.toLowerCase().includes(searchTerm) ||
                        exercise.category.toLowerCase().includes(searchTerm) ||
                        (exercise.equipment && exercise.equipment.toLowerCase().includes(searchTerm))
                    );
                    displayExercises(filteredExercises);
                });
            }
        }
        
        // Add category filtering
        function setupCategoryFilters() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    // Remove active class from all filters
                    filterBtns.forEach(b => b.classList.remove('active'));
                    // Add active class to clicked filter
                    e.target.classList.add('active');
                    
                    const category = e.target.dataset.category;
                    let filteredExercises;
                    
                    if (category === 'all') {
                        filteredExercises = exercisesData;
                    } else {
                        filteredExercises = exercisesData.filter(exercise => 
                            exercise.category.toLowerCase() === category.toLowerCase()
                        );
                    }
                    
                    displayExercises(filteredExercises);
                });
            });
        }
        
        // Theme Management
        function initializeTheme() {
            // Check for saved theme preference, default to dark for sleek look
            const savedTheme = localStorage.getItem('workout-tracker-theme') || 'dark';
            setTheme(savedTheme);
            
            // Set up theme button listeners
            const themeButtons = document.querySelectorAll('.theme-btn');
            themeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    setTheme(theme);
                    
                    // Update active button
                    themeButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Save preference
                    localStorage.setItem('workout-tracker-theme', theme);
                });
            });
        }
        
        function setTheme(theme) {
            const body = document.body;
            
            if (theme === 'auto') {
                // Use system preference
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                body.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            } else {
                body.setAttribute('data-theme', theme);
            }
            
            // Update theme-color meta tag
            const themeColorMeta = document.querySelector('meta[name="theme-color"]');
            if (theme === 'dark' || (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                themeColorMeta.content = '#000000';
            } else {
                themeColorMeta.content = '#007AFF';
            }
        }
        
        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            const currentTheme = localStorage.getItem('workout-tracker-theme');
            if (currentTheme === 'auto') {
                setTheme('auto');
            }
        });

        // Helper functions
        function switchToExercisesTab() {
            const exercisesTab = document.querySelector('[data-tab="exercises"]');
            if (exercisesTab) {
                exercisesTab.click();
                document.getElementById('workout-modal').style.display = 'none';
            }
        }
        
        function restoreWorkoutSession() {
            try {
                const savedWorkout = localStorage.getItem('currentWorkout');
                if (savedWorkout) {
                    window.currentWorkoutSession = JSON.parse(savedWorkout);
                    console.log('üîÑ Restored workout session:', window.currentWorkoutSession);
                    
                    // Update workout button text if there's an active session
                    const startBtn = document.getElementById('start-workout-btn');
                    if (startBtn && window.currentWorkoutSession && window.currentWorkoutSession.isActive) {
                        startBtn.textContent = 'Continue Workout';
                    }
                }
            } catch (error) {
                console.error('Error restoring workout session:', error);
                localStorage.removeItem('currentWorkout');
            }
        }
        
        // Initialize search and filters after a delay
        setTimeout(() => {
            setupExerciseSearch();
            setupCategoryFilters();
            initializeTheme();
        }, 3000);
    </script>
</body>
</html>